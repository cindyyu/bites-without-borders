<!DOCTYPE html>
<html>
	<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDfoJeJmD19uB8JZ-kfvJoKp5rxyRy7VOo"></script>
    <script>
    	var map;

    	var MY_MAPTYPE_ID = 'custom_style';
    	function initialize() {
    		var mapStyles = [ 
					{ 
						"featureType": "landscape", 
						"stylers": [ { "hue": "#6eff00" }, { "gamma": 1 }, { "saturation": -37 }, { "lightness": 30 } ] 
					},
					{ 
						"featureType": "water", 
						"stylers": [ { "hue": "#00aaff" }, { "saturation": -37 }, { "lightness": -4 } ] 
					},
					{ 
						"elementType": "geometry.stroke", 
						"stylers": [ { "visibility": "off" } ] 
					},
					{ 
						"elementType": "labels.text.stroke", 
						"stylers": [ { "visibility": "off" } ] 
					},
					{ 
						"elementType": "labels.text.fill", 
						"stylers": [ { "lightness": 32 } ] 
					},
					{ 
						"featureType": "administrative.locality",
						"elementType": "labels.icon", 
						"stylers": [ { "visibility": "off" } ] },
					{ 
						"featureType": "poi", 
						"elementType": "labels", 
						"stylers": [ { "visibility": "off" } ] 
					},
					{ 
						"featureType": "road", 
						"stylers": [ { "visibility": "off" } ] 
					},
					{ 
						"featureType": "transit", 
						"stylers": [ { "visibility": "off" } ] 
					},
					{ 
						"featureType": "administrative.locality", 
						"stylers": [ { "visibility": "simplified" } ] 
					}
				];

				var mapOptions = {
					zoom: 2, 
					disableDefaultUI: true,
					minZoom: 2,
					center: new google.maps.LatLng(30,0),
					mapTypeControlOptions: {
						mapTypeIds: [google.maps.MapTypeId.ROADMAP, MY_MAPTYPE_ID]
					},
					mapTypeId: MY_MAPTYPE_ID
				};

				map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

				var styledMapOptions = {
    			name: 'Recipes'
  			};
  			var customMapType = new google.maps.StyledMapType(mapStyles, styledMapOptions);
  			map.mapTypes.set(MY_MAPTYPE_ID, customMapType);

				var recipes = {{ recipes }};

				for (i = 0; i < recipes.length; i++) {
					commaPos = recipes[i]['latlng'].indexOf(',');
					latitude = recipes[i]['latlng'].substring(0, commaPos);
					longitude = recipes[i]['latlng'].substring(commaPos + 1, recipes[i]['latlng'].length);
					var recipeInfo = '<div id="recipeInfo">' +
						'<h3>' + recipes[i]['name'] + '</h3>' + 
						'<p>takes ' + recipes[i]['cooktime'] + ' long to prepare' + 
						'<a href="' + recipes[i]['recipeUrl'] + '">view more</a>' +
						'</div>';
					marker = new google.maps.Marker({
			      position: new google.maps.LatLng(latitude, longitude),
			      map: map,
			      infowindow: new google.maps.InfoWindow({content: recipeInfo, maxWidth: 500})
  				})

					google.maps.event.addListener(
						marker, 'click', function() {
							this.infowindow.open(map, this);
						}
					);
				}
    	}
    	google.maps.event.addDomListener(window, 'load', initialize);
    </script>

	</head>
	<body>
		{{ header }}

		{% if first_time %}
		  welcome for the first time!
		{% else %}
		  welcome back
		{% endif %}	<br /><br />
		<div style="width: 100%; height: 100%; z-index: -1; position: absolute; top: 0; left: 0;" id="map-canvas"></div>
	</body>
</html>